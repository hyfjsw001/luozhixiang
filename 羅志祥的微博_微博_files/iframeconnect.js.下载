(function(window,document,undefined){var cEvt=function(){var a=function(a){return Object.prototype.toString.call(a)==="[object Array]"},b=function(a){var b;return((b=typeof a)=="object"?a==null&&"null"||Object.prototype.toString.call(a).slice(8,-1):b).toLowerCase()},c="__custEventKey__",d=1,e={},f=function(a,b){var d=typeof a=="number"?a:a[c];return d&&e[d]&&{obj:typeof b=="string"?e[d][b]:e[d],key:d}},g={},h=function(a,b,c,d,e){if(a&&typeof b=="string"&&c){var g=f(a,b);if(!g||!g.obj)throw"custEvent ("+b+") is undefined !";g.obj.push({fn:c,data:d,once:e});return g.key}},i=function(a,c,d,e){var g=!0,h=function(){g=!1};if(a&&typeof c=="string"){var i=f(a,c),j;if(i&&(j=i.obj)){d=typeof d!="undefined"&&[].concat(d)||[];for(var k=j.length-1;k>-1&&j[k];k--){var l=j[k].fn,m=j[k].once;if(l&&l.apply)try{l.apply(a,[{obj:a,type:c,data:j[k].data,preventDefault:h}].concat(d));m&&j.splice(k,1)}catch(n){window.console&&console.log("[error][custEvent]"+n.message,n,n.stack)}}g&&b(e)==="function"&&e();return i.key}}},j={define:function(a,b){if(a&&b){var f=typeof a=="number"?a:a[c]||(a[c]=d++),g=e[f]||(e[f]={});b=[].concat(b);for(var h=0;h<b.length;h++)g[b[h]]||(g[b[h]]=[]);return f}},undefine:function(a,b){if(a){var d=typeof a=="number"?a:a[c];if(d&&e[d])if(b){b=[].concat(b);for(var f=0;f<b.length;f++)b[f]in e[d]&&delete e[d][b[f]]}else delete e[d]}},add:function(a,b,c,d){return h(a,b,c,d,!1)},once:function(a,b,c,d){return h(a,b,c,d,!0)},remove:function(b,c,d){if(b){var e=f(b,c),g,h;if(e&&(g=e.obj)){if(a(g))if(d){var i=0;while(g[i]){if(g[i].fn===d)break;i++}g.splice(i,1)}else g.splice(0,g.length);else for(var i in g)g[i]=[];return e.key}}},fire:function(a,b,c,d){return i(a,b,c,d)},hook:function(a,b,f){if(!(!a||!b||!f)){var h=[],k=a[c],l=k&&e[k],m,n=b[c]||(b[c]=d++),o;if(l){o=g[k+"_"+n]||(g[k+"_"+n]={});var p=function(a){var c=!0;i(b,o[a.type].type,Array.prototype.slice.apply(arguments,[1,arguments.length]),function(){c=!1});c&&a.preventDefault()};for(var q in f){var r=f[q];if(!o[q])if(m=l[q]){m.push({fn:p,data:undefined});o[q]={fn:p,type:r};h.push(r)}}j.define(b,h)}}},unhook:function(a,b,d){if(!(!a||!b||!d)){var e=a[c],f=b[c],h=g[e+"_"+f];if(h)for(var i in d){var k=d[i];h[i]&&j.remove(a,i,h[i].fn)}}},destroy:function(){e={};d=1;g={}}};return j}(),utils={count:0,getUniqueKey:function(){return+(new Date)+(Math.random()+"").replace(".","")+utils.count++},json2str:function(){function i(a,b){var c,f,j,k,l=d,m,n=b[a];n&&typeof n=="object"&&typeof n.toJSON=="function"&&(n=n.toJSON(a));typeof g=="function"&&(n=g.call(b,a,n));switch(typeof n){case"string":return h(n);case"number":return isFinite(n)?String(n):"null";case"boolean":case"null":return String(n);case"object":if(!n)return"null";d+=e;m=[];if(Object.prototype.toString.apply(n)==="[object Array]"){k=n.length;for(c=0;c<k;c+=1)m[c]=i(c,n)||"null";j=m.length===0?"[]":d?"[\n"+d+m.join(",\n"+d)+"\n"+l+"]":"["+m.join(",")+"]";d=l;return j}if(g&&typeof g=="object"){k=g.length;for(c=0;c<k;c+=1){f=g[c];if(typeof f=="string"){j=i(f,n);j&&m.push(h(f)+(d?": ":":")+j)}}}else for(f in n)if(Object.hasOwnProperty.call(n,f)){j=i(f,n);j&&m.push(h(f)+(d?": ":":")+j)}j=m.length===0?"{}":d?"{\n"+d+m.join(",\n"+d)+"\n"+l+"}":"{"+m.join(",")+"}";d=l;return j}}function h(a){c.lastIndex=0;return c.test(a)?'"'+a.replace(c,function(a){var b=f[a];return typeof b=="string"?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function a(a){return a<10?"0"+a:a}if(typeof Date.prototype.toJSON!="function"){Date.prototype.toJSON=function(b){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()}}var b=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,c=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,d,e,f={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},g;return function(a,b,c){if(window.JSON&&window.JSON.stringify)return window.JSON.stringify(a,b,c);var f;d="";e="";if(typeof c=="number")for(f=0;f<c;f+=1)e+=" ";else typeof c=="string"&&(e=c);g=b;if(!b||typeof b=="function"||typeof b=="object"&&typeof b.length=="number")return i("",{"":a});throw new Error("JSON.stringify")}}(),str2json:function(str){try{return eval("("+str+")")}catch(e){return null}},getUrlParam:function(a){var b=new RegExp("(^|&)"+a+"=([^&]*)(&|$)"),c=window.location.search.substr(1).match(b);return c!=null?unescape(c[2]):null}},iframeConnect=function(){var a={},b={},c=window.name,d=function(a,b,d){var e=utils.json2str(d===undefined?{iid:c,cid:a,cmd:b}:{iid:c,cid:a,cmd:b,param:d});window.parent.postMessage?window.parent.postMessage(e,"*"):window.navigator.STK_IFRAME_CONNECT_OUT(e)},e=function(c){try{var d=utils.str2json(c.data);if(d.cid&&d.cid=="_EVENT_"){cEvt.define(b,d.call);cEvt.fire(b,d.call,d.rs)}else if(d.cid&&d.cid in a)try{var e=d.call=="callback"?a[d.cid]:a[d.cid][d.call];e(d.rs);delete a[d.cid]}catch(f){}}catch(f){}};window.postMessage?window.addEventListener?window.addEventListener("message",e,!1):window.attachEvent("onmessage",e):window.navigator["STK_IFRAME_CONNECT_"+c]=function(a){e({data:a})};return{trigger:function(b,c,e){if((typeof c).toUpperCase()==="FUNCTION"){e=c;c=undefined}var f=utils.getUniqueKey();e&&(a[f]=e);d(f,b,c)},on:function(a,c){cEvt.define(b,a);cEvt.add(b,a,c)},off:function(a,c){cEvt.remove(b,a,c)}}},iconnect=window.iconnect=iframeConnect();window.iframeConnect=function(){return iconnect};iconnect.setHeight=function(a,b){iconnect.trigger("setHeight",a,b)};iconnect.getLayoutInfo=function(a){iconnect.trigger("getLayoutInfo",a)};iconnect.oauth=function(a){if(a.appkey!=null&&a.callback!=null){var b=document,c="page_app_oauth_iframe",d="https://api.weibo.com/2/oauth2/authorize?client_id="+a.appkey+"&response_type=code&redirect_uri="+encodeURIComponent(a.callback)+"&quick_auth=true";if(b.getElementById(c)==null){var e=b.createElement("iframe");e.id=c;e.style.cssText="position:absolute;left:-1000px;top:-1000px;display:none";e.src=d;document.body.appendChild(e)}else b.getElementById(c).src=d}}})(window,document);
;
